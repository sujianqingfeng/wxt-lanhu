# 插件市场发布准备清单（Chrome Web Store / Edge Add-ons）

本文面向本项目（WXT + MV3）的发布流程，按“发布前检查 → 打包 → 上架资料 → 合规 → 提交 → 发布后”整理。

## 1. 发布前检查

- 版本号：更新 `package.json` 的 `version`（或 `wxt.config.ts`/manifest 的版本策略）并确认本次变更点
- 基本功能回归：
  - 蓝湖页面打开 popup → `加载/刷新/清缓存` 正常
  - 线框图点击选中、同点重复点击“扩选”正常
  - 导出 JSON、复制、过滤空字段开关正常
  - 缓存命中：关闭 popup 再打开不重新请求（除非点刷新）
- 错误提示：未登录/无权限/接口失败时文案清晰（不要只显示 “加载失败”）
- 秘钥/凭证：确认仓库与 README 不包含 cookie、token、session、trace id 等敏感信息

## 2. 打包产物

本项目输出目录为 `output/`。

- 生产构建：
  - `npm run build`
  - 产物在 `output/chrome-mv3`
- 生成 zip（推荐）：
  - `npm run zip`
  - 或手动把 `output/chrome-mv3` 目录内容压缩为 zip（zip 根目录应直接包含 `manifest.json` 等文件）

> 提醒：不要把 `output/` 的上级目录或整个仓库压缩上传；应上传构建后的扩展目录内容。

## 3. 商店上架资料（Listing）

通常需要准备：

- 名称：例如 `Lanhu Layer Tree`
- 简短描述：一句话描述核心能力（线框图选择 + 导出 descendants + 缓存）
- 详细描述：
  - 使用场景与步骤
  - 主要功能点
  - 注意事项（需登录蓝湖、依赖蓝湖权限）
- 截图：
  - 线框图视图（点击选择）
  - 树视图（搜索）
  - 导出结果（JSON）
  - 缓存提示/刷新按钮（说明不会反复请求）
- 图标：
  - 本项目已包含 `public/icon/*`（16/32/48/96/128）与源文件 `public/icon/icon.svg`
- 分类、语言、支持邮箱/官网（可选）

## 4. 权限与合规（非常重要）

### 4.1 权限用途说明（建议写进商店的权限解释）

本扩展当前使用的权限（见 `wxt.config.ts`）：

- `tabs`
  - 用途：读取当前活动标签页 URL，自动解析 `project_id`/`image_id`，避免用户手动复制粘贴
- `storage`
  - 用途：缓存蓝湖返回的 JSON（按 `project_id + image_id`），减少重复请求与等待
- `host_permissions`
  - `https://lanhuapp.com/*`：请求 `api/project/image` 获取 `json_url`
  - `https://alipic.lanhuapp.com/*`：拉取设计 JSON（`FigmaJSON*.json`）

### 4.2 隐私政策（建议必备）

即便不“收集用户数据”，也建议提供一份非常短的隐私政策，避免审核卡住。

你可以按如下模板改成你自己的信息并发布到一个可访问的 URL（例如 GitHub Pages、公司站点、Notion 公开页等）：

> **隐私政策（模板）**
>
> 本扩展用于在蓝湖页面中拉取设计 JSON 并在本地展示/导出选中节点的结构数据。
>
> - 数据收集：本扩展不向开发者服务器上传任何数据。
> - 数据使用：仅在用户浏览器内请求蓝湖接口并处理返回结果。
> - 本地存储：为减少重复请求，扩展会将蓝湖返回的 JSON 缓存在浏览器本地存储中；用户可随时点击“清缓存”删除。
> - 第三方共享：不与任何第三方共享用户数据（蓝湖接口请求本身除外）。
> - 联系方式：xxx@xxx.com

### 4.3 数据安全表单（CWS Data Safety）

按实际情况填写即可。对本项目一般是：

- 是否收集数据：通常选择“不收集/不传输到开发者服务器”
- 是否处理个人信息：避免夸大；说明仅在本地处理并用于功能实现
- 是否加密传输：请求蓝湖为 HTTPS

## 5. 提交流程（Chrome Web Store）

1. 注册开发者账号并完成开发者资料
2. 创建新扩展 → 上传 zip
3. 填写 listing（名称/描述/截图/分类等）
4. 填写权限说明、隐私政策 URL、Data Safety 表单
5. 设置可见性（公开/不公开/仅测试）并提交审核

## 6. 发布后

- 监控反馈：崩溃/加载失败/权限问题
- 版本迭代：每次发布提升版本号并更新变更说明
- 兼容性：蓝湖接口与 JSON 结构可能变化，建议保留调试日志与回退策略

## 7. 建议的商店文案（可直接用）

### 标题
Lanhu Layer Tree

### 简短描述
在蓝湖中以线框图/树方式选择图层，并导出选中节点及其所有子节点（支持缓存与空字段过滤）。

### 详细描述（示例）
- 线框图：在弹窗中显示设计稿的线框矩形，点击即可选中图层；重复点击同一区域可扩选更大的容器层
- 树视图：按层级浏览与搜索（name/id）
- 导出：导出选中节点与所有 descendants 的结构与样式数据（可过滤空字段）
- 缓存：按 `project_id + image_id` 缓存，减少重复请求；支持刷新/清缓存

使用方法：
1) 登录蓝湖并打开设计图页面  
2) 点击扩展图标 → 右上角点“加载”  
3) 在“线框图/树”中选中目标节点 → 导出  

